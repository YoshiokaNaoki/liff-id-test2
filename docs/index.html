<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ID TokenからユーザーID取得調査</title>
        <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

        <style>

          .buttonCss {
              font-size: 20px;
              font-weight: bold;
              -webkit-appearance: none; 
              width:200px; 
              height:50px;
          }

        </style>

      </head>
    <body>

<script>

var myLiffId = '1634329436-nW9OzZE7';
var channelId = '1634329436'
var idToken = '';

function liffInit() {
  var divElm = document.getElementById("console");
  liff.init({
            liffId: myLiffId
        })
        .then(() => {
          if (liff.isLoggedIn() == false) {
            liff.login();
          } else {
            divElm.innerHTML = "LOGINED"            
          }
        })
        .catch((err) => {
          divElm.innerHTML = err;           
        });
}

function liffReLogin() {
    var divElm = document.getElementById("console");
    liff.init({
            liffId: myLiffId
        })
        .then(() => {
          if (liff.isLoggedIn()) {
            divElm.innerHTML = "LOGIN SUCCESS";
          } else {
            divElm.innerHTML = "LOGIN ERROR";
          }
        })
        .catch((err) => {
          divElm.innerHTML = err;           
        });

}


function IDToken() {
  idToken = liff.getIDToken();
  var divElm = document.getElementById("console");
  divElm.innerHTML = idToken;
}

function Logout() {
  liff.logout();
  window.location.reload();
}

function Verify() {
    var divElm = document.getElementById("console");
    var postData = 'id_token=' + idToken + '&client_id=' + channelId;
    // var postData = {'id_token': idToken, 'client_id': channelId};
    console.log( postData );


    $.post( 'https://api.line.me/oauth2/v2.1/verify', 'id_token=eyJraWQiOiJhNzk2OGMyZWExNWYwZjQxNjM1ZGU1ZTA4ODI5MDQ5MWIwMjMxYTU2YTQ5Y2M4YTZjZDZlZDQ0MTcyN2EyNTJmIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJpc3MiOiJodHRwczovL2FjY2Vzcy5saW5lLm1lIiwic3ViIjoiVTE5NzBjNjYzYjBmOTZhYWMyZjExY2FiYjFiOTFkZmQ2IiwiYXVkIjoiMTYzNDMyOTQzNiIsImV4cCI6MTYxMzExODcyMywiaWF0IjoxNjEzMTE1MTIzLCJhbXIiOlsibGluZXNzbyJdLCJuYW1lIjoiWW9zaGlvX0siLCJwaWN0dXJlIjoiaHR0cHM6Ly9wcm9maWxlLmxpbmUtc2Nkbi5uZXQvMGhpenRSMDdTUU5sVkpLeGlPUlNSSkFuVnVPRGctQlRBZE1VUXNNejU3Ympac0dIWlVjVXg3TVdsLU8yQnRUaUVIZEUxLU4yNS1PekJtIn0.xXRu80UlavBwDGXD-W295W8_NUBc5nRPkkKiETFpyXIUOYauphBW_QI-7BiZNpBNC7KzCT35y3Vffc2XMFQ98Q&client_id=1634329436' )
    .done(function( data ) {
      console.log( data );
      divElm.innerHTML = data;
    })
}

</script>

 <body>
  
    <h1>ID TokenからユーザーID取得調査</h1>
    <hr>

      
    <input type="button" value="liff.init()" onclick="liffInit()" class="buttonCss">
    <input type="button" value="liff.login()" onclick="liffReLogin()" class="buttonCss">
    <input type="button" value="liff.getIDToken()" onclick="IDToken()" class="buttonCss">
    <input type="button" value="Verify()" onclick="Verify()" class="buttonCss">
    <input type="button" value="liff.Logout()" onclick="Logout()" class="buttonCss">

    <h2>出力内容</h2>
      
    <div style="width:800px; height:300px; background-color:lightgray;  border:2px solid #aaa;">
      <div id="console" style="width:700px; height:300px; word-wrap:break-all;overflow-wrap: break-word;"></div>
    </div>

  </body>
</html>

